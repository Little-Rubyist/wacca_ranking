.container
  %h1 My Page
  = search_form_for @q, url: user_path do |f|
    .card
      .card-body
        %h5.card-title 検索
        .row
          .col-lg-3
            = f.label :song_difficulty_gteq, 'レベル', class: 'form-label'
            %output#difficulty-value-id{name: 'difficultyValue'} 未選択
            %a.btn.btn-outline-secondary.btn-sm{onclick: 'resetDifficulty()'} リセット
            = f.range_field :song_difficulty_gteq, { min: 1, max: 15, step: 0.1, oninput: 'updateTextInput(this.value)', class: 'form-range' }
          .col-lg-3.col-md-4
            = f.label :song_diff_type_eq, '難易度', class: 'form-label'
            = f.select :song_diff_type_eq, Song.diff_types.map { |k, v| [Song.human_attribute_enum_value(:diff_type, k), v] }.to_h, {include_blank: true},  {class: 'form-select'}
          .col-lg-3.col-md-4
            = f.label :song_title_matches, 'タイトル', class: 'form-label'
            = f.search_field :song_title_matches, class: 'form-control'
          .col-lg-3.col-md-4
            = f.label :user_scores_achieve_eq, 'FC状況', class: 'form-label'
            = f.select :user_scores_achieve_eq, UserScore.achieves.map { |k, v| [UserScore.human_attribute_enum_value(:achieve, k), v] }.to_h, {include_blank: true}, {class: 'form-select'}
        .d-grid.gap-2.d-block.justify-content-end.m-3
          = f.submit '検索', class: 'btn btn-primary'
  .table-responsive
    %table.table
      %thead
        %tr
          %th{scope: "col"} title
          %th{scope: "col"} diff
          %th{scope: "col"} diff_type
          %th{scope: "col"} score
          %th{scope: "col"} achieve
      %tbody
        - @songs.each do |song|
          %tr
            %th{scope: 'row'} #{song.song.title}
            %td #{song.song.difficulty}
            %td #{song.song.diff_type}
            %td #{@scores.find{ |x| x.user_song_id === song.id }&.score}
            %td #{@scores.find{ |x| x.user_song_id === song.id }&.achieve}
  .d-flex.justify-content-center.mb-2
    = pagy_bootstrap_nav(@pagy).html_safe
